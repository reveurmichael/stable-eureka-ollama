def compute_reward(self, pos, action, state):
    hull_angle = state[0]
    vel_x = state[2]
    terminal = (pos[0] < 0) or self.game_over

    if terminal:
        reward = -1.0
        individual_reward = {"fall": -1.0}
    else:
        # Encourage forward movement and velocity
        movement_reward = np.exp((pos[0] + VIEWPORT_W / SCALE / 5) / TERRAIN_LENGTH) * vel_x
        # Punish falling or getting stuck
        fall_penalty = max(-np.exp(hull_angle), 0)
        # Reward fitness score progress
        fitness_progress = -abs(fitness_score(state) - self.prev_fitness_score)
        reward = movement_reward + fitness_progress - fall_penalty
        individual_reward = {"movement": movement_reward, "fall": fall_penalty, "fitness": fitness_progress}
        
        self.prev_fitness_score = fitness_score(state)

    return reward, individual_reward