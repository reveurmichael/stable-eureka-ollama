def compute_reward(self, pos, action, state):
    distance_to_goal = TERRAIN_LENGTH - pos[0]
    
    if self.game_over or pos[0] < 0:
        return -100.0, {"terminal": True}
    elif pos[0] > (TERRAIN_LENGTH - TERRAIN_GRASS) * TERRAIN_STEP:
        return 100.0, {"success": True}
    
    # Reward distance to goal
    distance_reward = min(distance_to_goal / TERRAIN_LENGTH, 1.0)
    
    # Penalty for falling
    fall_penalty = -20.0 if state[-1] else 0.0
    
    # Additional penalty for struggling (if applicable)
    struggle_penalty = -10.0 if state[3] > 1.5 else 0.0
    
    return distance_reward + fall_penalty + struggle_penalty, {}